<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Why SeaJS</title>
  <link rel="stylesheet" type="text/css" href="/assets/css/screen.css">
</head>
<body>
  <div id="page">
  
  <div class="article-wrap article-intro">
    <article>
      <h2>Why SeaJS</h2>
      <div class="subtitle">or What a wonderful world with module loader</div>
      <div class="content"><p>Okay, You are a decent Frontent Engineer.
After finished books like <em>JavaScript: the Good Parts</em> and <em>JavaScript Web Applications</em>,
you probably write js like this:</p>

<div class="highlight"><pre><code class="js"><span class="c1">// wrap my awesome code in an anonymous function call, get clousured!</span>
<span class="c1">// yeah, you heared me.</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">brian_said</span> <span class="o">=</span> <span class="s1">&#39;hello world&#39;</span><span class="p">,</span>
        <span class="nx">ritchie_said_also</span> <span class="o">=</span> <span class="s1">&#39;konicuwa world?&#39;</span><span class="p">;</span>

    <span class="c1">// more code</span>
<span class="p">})();</span>
</code></pre>
</div>


<p>Then your project gets bigger, you found yourself should get your code modulized
for better trans-page sharing.</p>

<div class="highlight"><pre><code class="js"><span class="c1">// All I need is a tiny little spot to hold my precious data and methods.</span>
<span class="c1">// Gollum: My precious...</span>
<span class="kd">var</span> <span class="nx">Precious</span> <span class="o">=</span> <span class="p">{};</span>

<span class="c1">// module one</span>
<span class="nx">Precious</span><span class="p">.</span><span class="nx">mod1</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// no more hello world plz.</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="c1">// exports methods</span>
    <span class="p">}</span>
<span class="p">})();</span>

<span class="c1">// module two</span>
<span class="nx">Precious</span><span class="p">.</span><span class="nx">mod2</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// how about ohayo js?</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="c1">// exports methods</span>
    <span class="p">}</span>
<span class="p">})();</span>
</code></pre>
</div>


<p>Those pages of your project differs. Some need module 1, 3, 5, some need module 2, 4, 6.
So you split those codes into separate files and load them specifically in the corresponding page.
Your page bottom might looks like this:</p>

<div class="highlight"><pre><code class="html"><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script&gt;</span><span class="kd">var</span> <span class="nx">Precious</span> <span class="o">=</span> <span class="p">{};</span><span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;mod1.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;mod2.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;mod3.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>


<p>The requirements of that very project changes, a lot. Page A requires module 1, 3, 5 at first,
suddenly in the next day it cries for module 2, 4, 6. Tedious work like changing script tags
starting to take up a great portion of your time.</p>

<p>And it gets worse, modules have dependencies. There will be lots of bugs caused by circumstances like
page <code>foo</code> requires module <code>blah</code>, so you add it, but blah rquires module <code>tongue</code> and you just forgot.</p>

<p>Starting to think that what the frontend egineering world would be if JavaScript had any module system?
SeaJS come rescue.</p>
</div>
    </article>
  </div>
  
  <div class="article-wrap article-basic">
    <article>
      <h2>Meet SeaJS</h2>
      <div class="subtitle">or How to get your code modulized</div>
      <div class="content"><p>SeaJS implements its module system according to CMD, <em>Common Module Definition</em>.
But we are not getting there yet. Let's start from the basics.</p>

<p>First thing first, SeaJS isn't magic.
Like those famous libraries in the JavaScript world, SeaJS is written in pure JavaScript.</p>

<p>So you need to load it in your page first.</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;sea.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre>
</div>


<p>And like <code>$</code> from jQuery, SeaJS is used via global object and function.
Namely, <code>seajs</code> and <code>define</code>.</p>

<p>With SeaJS, we can define some module.</p>

<div class="highlight"><pre><code class="js"><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;console&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">exports</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">console</span> <span class="o">&amp;&amp;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">});</span>
</code></pre>
</div>


<p>And use it.</p>

<div class="highlight"><pre><code class="js"><span class="nx">seajs</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;console&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">console</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// now you can stop worrying about whether or not `console` is provided.</span>
    <span class="c1">// use it freely!</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;hello world!&#39;</span><span class="p">);</span>

    <span class="c1">// well, we need to enhance the `console` module a bit.</span>
    <span class="c1">// for methods like console.warn, and method calls like console.log(msg1, msg2, msg3);</span>
<span class="p">});</span>
</code></pre>
</div>


<p>What about module dependencies? Here comes <code>require</code></p>

<div class="highlight"><pre><code class="js"><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;jordan&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span> <span class="nx">exports</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// you can require inline</span>
    <span class="nx">exports</span><span class="p">.</span><span class="nx">chamionship</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Michael and Scottie should be together!</span>
        <span class="k">return</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pippen&#39;</span><span class="p">).</span><span class="nx">hasJoined</span><span class="p">();</span>
    <span class="p">};</span>

    <span class="c1">// or, you can require module in the head.</span>
    <span class="kd">var</span> <span class="nx">rodman</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;rodman&#39;</span><span class="p">);</span>

    <span class="nx">exports</span><span class="p">.</span><span class="nx">next3</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Dennis is the monster</span>
        <span class="k">return</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;rodman&#39;</span><span class="p">).</span><span class="nx">hasJoined</span><span class="p">();</span>
    <span class="p">};</span>
<span class="p">});</span>
</code></pre>
</div>


<p>But we need our code splitted into different files!
Hang on. That is exactly what SeaJS is good at.</p>
</div>
    </article>
  </div>
  
  <div class="article-wrap article-async">
    <article>
      <h2>Asynchronous JavaScript Modules</h2>
      <div class="subtitle">or Why is SeaJS implemented this way.</div>
      <div class="content"><p>Now comes the cliche. The creator, Brendan Eich, implemented it within weeks.
The initial goal was to be able to write snippets to make the web more interactive, a little.
So, that results in some drawbacks of this language.
Dauglas Crockford summarized some of those in the book <em>JavaScript: The Good Parts</em>.</p>

<p>Being lack of module system is one of those drawbacks.
Some of you might heared or tried Node.js, that is module support of JavaScript done right.</p>

<p>But there are some interesting facts of JavaScript in the browser land.</p>

<ul>
<li>You can insert a <code>script</code> tag via js with an <code>@src</code> to load js dynamically.</li>
<li>You can listen on that <code>script</code> tag's <code>onload</code>, <code>onerror</code> or <code>oncomplete</code> events.</li>
</ul>


<p>Well, browsers have there inconsistencies in the event stuff of <code>script</code> tag.
But it's solved in SeaJS! ...almost!</p>

<p>With that two fact combined, we can do some thing like this:</p>

<ol>
<li>Load the bootstrap js</li>
<li>Load different modules accordingly</li>
<li>Perform tasks when those modules were loaded!</li>
</ol>


<p>That's what SeaJS is all about.</p>

<p>We load it to bootstrap:</p>

<div class="highlight"><pre><code class="html"><span class="c">&lt;!-- the library and your app --&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;sea.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;app.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre>
</div>


<p>As a matter of fact, SeaJS also provide a shortcut for bootstraping your app.
So instead of two script tags, you can load it via <code>@data-main</code>.</p>

<div class="highlight"><pre><code class="html"><span class="c">&lt;!-- more compact way --&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;sea.js&quot;</span> <span class="na">data-main=</span><span class="s">&quot;./app&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre>
</div>


<p><code>./</code> means relative to current page url. Given page url <code>http://foo.com/hello/world.html</code>,
SeaJS will load <code>http://foo.com/hello/app.js</code>.</p>

<p>The <code>./app</code> is called module id in SeaJS. Instead of relative way,
you can write module id in absolute path. Well, not so absolute.
In this example, <code>hello/app</code> refers to <code>base</code> path + module id + <code>.js</code>.</p>

<p>What is <code>base</code> path?
SeaJS uses <code>base</code> to resolve module uri if the module id does not start with an <code>.</code>.
It can be configured:</p>

<div class="highlight"><pre><code class="js"><span class="nx">seajs</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
    <span class="nx">base</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span>
<span class="p">});</span>
</code></pre>
</div>


<p>With <code>base</code> configured, now <code>hello/app</code> will be resolved to <code>http://foo.com/hello/app.js</code>.</p>

<p>When you require module within module, the rules are the same.
Relative paths will be solved relative to current module uri.</p>

<div class="highlight"><pre><code class="js"><span class="c1">// http://foo.com/worker/carpenter.js</span>
<span class="nx">define</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span> <span class="nx">exports</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">hammer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../util/hammer&#39;</span><span class="p">);</span>

    <span class="nx">exports</span><span class="p">.</span><span class="nx">nail</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">hammer</span><span class="p">.</span><span class="nx">smash</span><span class="p">();</span>
    <span class="p">};</span>
<span class="p">});</span>
</code></pre>
</div>


<p>That hammer is <code>http://foo.com/util/hammer.js</code>.</p>

<p>The Only difference with Node.js, is that your module code (and your app code)
needs to be wrapped in a typical <code>define</code> callback.</p>

<div class="highlight"><pre><code class="js"><span class="nx">define</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">dependencies</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span> <span class="nx">exports</span><span class="p">,</span> <span class="nx">module</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// module code.</span>
<span class="p">});</span>
</code></pre>
</div>


<p>The <code>id</code> and <code>dependencies</code> parameters can be omitted.</p>

<p><code>id</code> is used mostly when your project went online.
All of your modules used in that page gets combined into one file.
SeaJS can not guess which modules is which by that script's <code>@src</code>.
Normally you will not need to use that.</p>

<p><code>dependencies</code> is the other parameter used only in combined js files in normal circumstances.
It list out what modules current module is dependent on.
But you don't have to provide that list when you are writing a module.
SeaJS will inspect your module callback and find out all of the <code>require</code> statements,
and therefore, get all of your module's dependencies.</p>

<p>That relies on important rules.</p>

<ul>
<li>You should not rename <code>require</code></li>
<li>You should not rewrite <code>require</code></li>
</ul>


<p>Think <code>requrie</code> as a reserved word in JavaScript programming language.
You're good to go.</p>
</div>
    </article>
  </div>
  
  <div class="article-wrap article-dive-into">
    <article>
      <h2>Dive Into SeaJS</h2>
      <div class="subtitle">or How to handle complex code architecture.</div>
      <div class="content"><p>We will be writing a hello world generator,
which says hello in different programming languages.
Let's define those modules first.</p>

<p><code>lang/ruby.js</code></p>

<div class="highlight"><pre><code class="js"><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;#!ruby&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;puts &quot;Hello, #{&#39;</span> <span class="o">+</span> <span class="nx">msg</span> <span class="o">+</span> <span class="s1">&#39;}&quot;&#39;</span>
<span class="p">);</span>
</code></pre>
</div>


<p><code>lang/js.js</code></p>

<div class="highlight"><pre><code class="js"><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;(function(console) {&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;    console.log(&quot;Hello&quot;, msg);&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;})(window.console || {&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;    log: function() {}&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;});&#39;</span>
<span class="p">);</span>
</code></pre>
</div>


<p><code>lang/lisp.js</code></p>

<div class="highlight"><pre><code class="js"><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;(print &quot;Hello, &#39;</span> <span class="o">+</span> <span class="nx">string</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;\\&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;&quot;)&#39;</span>
<span class="p">);</span>
</code></pre>
</div>




<div class="highlight"><pre><code class="html"><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;pre</span> <span class="na">id=</span><span class="s">&quot;output&quot;</span> <span class="na">data-lang=</span><span class="s">&quot;ruby&quot;</span><span class="nt">&gt;&lt;/pre&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;sea.js&quot;</span> <span class="na">data-main=</span><span class="s">&quot;./generator&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>


<p>the generator should be able to perform these tasks, in specific order:</p>

<ol>
<li>read <code>@data-lang</code> from <code>pre</code> tag.</li>
<li>determine the corresponding language module, and get the result.</li>
<li>shove the result back into the <code>pre</code> tag.</li>
</ol>


<div class="highlight"><pre><code class="js"><span class="nx">seajs</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;./util/html&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">HTMLUtil</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">pre</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">),</span>
        <span class="nx">lang</span> <span class="o">=</span> <span class="nx">pre</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-lang&#39;</span><span class="p">),</span>
        <span class="nx">res</span><span class="p">;</span>

    <span class="nx">seajs</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;./lang/&#39;</span> <span class="o">+</span> <span class="nx">lang</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lang</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span> <span class="o">=</span> <span class="nx">lang</span><span class="p">.</span><span class="nx">hello</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">pre</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">HTMLUtil</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>


<p>Now back to the problem raised in the begginning. We can solve it
with the knowledge of SeaJS so far. Every page should have one and only one <code>script</code> tag,
which just differs in the <code>@data-main</code> attribute.</p>

<div class="highlight"><pre><code class="html"><span class="c">&lt;!-- page a --&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;sea.js&quot;</span> <span class="na">data-main=</span><span class="s">&quot;./page-a&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>

<span class="c">&lt;!-- page b --&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;sea.js&quot;</span> <span class="na">data-main=</span><span class="s">&quot;./page-b&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre>
</div>


<p>Those <code>(function(){})();</code> modules can be organized via <code>define</code> in separated files.
use <code>require</code> for inner module inclusion. Then page a, b, c <code>.js</code> files can be written like this.</p>

<div class="highlight"><pre><code class="js"><span class="nx">seajs</span><span class="p">.</span><span class="nx">use</span><span class="p">([</span><span class="s1">&#39;mod1&#39;</span><span class="p">,</span> <span class="s1">&#39;mod2&#39;</span><span class="p">,</span> <span class="s1">&#39;mod3&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ah my awesome code.</span>
<span class="p">});</span>
</code></pre>
</div>



</div>
    </article>
  </div>
  
</div>
</body>
</html>
